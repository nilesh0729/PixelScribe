// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: performance_summary.sql

package db

import (
	"context"
	"database/sql"
)

const createPerformanceSummary = `-- name: CreatePerformanceSummary :one
INSERT INTO performance_summary (
    user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
) VALUES (
    $1, $2, $3, $4, $5, $6, $7
)
RETURNING id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
`

type CreatePerformanceSummaryParams struct {
	UserID          sql.NullInt64   `json:"user_id"`
	DictationID     sql.NullInt64   `json:"dictation_id"`
	TotalAttempts   sql.NullInt32   `json:"total_attempts"`
	BestAccuracy    sql.NullFloat64 `json:"best_accuracy"`
	AverageAccuracy sql.NullFloat64 `json:"average_accuracy"`
	AverageTime     sql.NullFloat64 `json:"average_time"`
	LastAttemptAt   sql.NullTime    `json:"last_attempt_at"`
}

func (q *Queries) CreatePerformanceSummary(ctx context.Context, arg CreatePerformanceSummaryParams) (PerformanceSummary, error) {
	row := q.db.QueryRowContext(ctx, createPerformanceSummary,
		arg.UserID,
		arg.DictationID,
		arg.TotalAttempts,
		arg.BestAccuracy,
		arg.AverageAccuracy,
		arg.AverageTime,
		arg.LastAttemptAt,
	)
	var i PerformanceSummary
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.DictationID,
		&i.TotalAttempts,
		&i.BestAccuracy,
		&i.AverageAccuracy,
		&i.AverageTime,
		&i.LastAttemptAt,
	)
	return i, err
}

const deletePerformanceSummary = `-- name: DeletePerformanceSummary :exec
DELETE FROM performance_summary
WHERE id = $1
`

func (q *Queries) DeletePerformanceSummary(ctx context.Context, id int64) error {
	_, err := q.db.ExecContext(ctx, deletePerformanceSummary, id)
	return err
}

const getPerformanceSummaryByID = `-- name: GetPerformanceSummaryByID :one
SELECT id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
FROM performance_summary
WHERE id = $1
`

func (q *Queries) GetPerformanceSummaryByID(ctx context.Context, id int64) (PerformanceSummary, error) {
	row := q.db.QueryRowContext(ctx, getPerformanceSummaryByID, id)
	var i PerformanceSummary
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.DictationID,
		&i.TotalAttempts,
		&i.BestAccuracy,
		&i.AverageAccuracy,
		&i.AverageTime,
		&i.LastAttemptAt,
	)
	return i, err
}

const getPerformanceSummaryByUserAndDictation = `-- name: GetPerformanceSummaryByUserAndDictation :one
SELECT id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
FROM performance_summary
WHERE user_id = $1 AND dictation_id = $2
`

type GetPerformanceSummaryByUserAndDictationParams struct {
	UserID      sql.NullInt64 `json:"user_id"`
	DictationID sql.NullInt64 `json:"dictation_id"`
}

func (q *Queries) GetPerformanceSummaryByUserAndDictation(ctx context.Context, arg GetPerformanceSummaryByUserAndDictationParams) (PerformanceSummary, error) {
	row := q.db.QueryRowContext(ctx, getPerformanceSummaryByUserAndDictation, arg.UserID, arg.DictationID)
	var i PerformanceSummary
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.DictationID,
		&i.TotalAttempts,
		&i.BestAccuracy,
		&i.AverageAccuracy,
		&i.AverageTime,
		&i.LastAttemptAt,
	)
	return i, err
}

const listPerformanceSummaryByUser = `-- name: ListPerformanceSummaryByUser :many
SELECT id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
FROM performance_summary
WHERE user_id = $1
ORDER BY last_attempt_at DESC
`

func (q *Queries) ListPerformanceSummaryByUser(ctx context.Context, userID sql.NullInt64) ([]PerformanceSummary, error) {
	rows, err := q.db.QueryContext(ctx, listPerformanceSummaryByUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PerformanceSummary
	for rows.Next() {
		var i PerformanceSummary
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.DictationID,
			&i.TotalAttempts,
			&i.BestAccuracy,
			&i.AverageAccuracy,
			&i.AverageTime,
			&i.LastAttemptAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const recentAttemptsByUser = `-- name: RecentAttemptsByUser :many
SELECT id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
FROM performance_summary
WHERE user_id = $1
ORDER BY last_attempt_at DESC
LIMIT $2
`

type RecentAttemptsByUserParams struct {
	UserID sql.NullInt64 `json:"user_id"`
	Limit  int32         `json:"limit"`
}

func (q *Queries) RecentAttemptsByUser(ctx context.Context, arg RecentAttemptsByUserParams) ([]PerformanceSummary, error) {
	rows, err := q.db.QueryContext(ctx, recentAttemptsByUser, arg.UserID, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PerformanceSummary
	for rows.Next() {
		var i PerformanceSummary
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.DictationID,
			&i.TotalAttempts,
			&i.BestAccuracy,
			&i.AverageAccuracy,
			&i.AverageTime,
			&i.LastAttemptAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updatePerformanceSummary = `-- name: UpdatePerformanceSummary :one
UPDATE performance_summary
SET
    total_attempts = $1,
    best_accuracy = $2,
    average_accuracy = $3,
    average_time = $4,
    last_attempt_at = $5
WHERE id = $6
RETURNING id, user_id, dictation_id, total_attempts, best_accuracy, average_accuracy, average_time, last_attempt_at
`

type UpdatePerformanceSummaryParams struct {
	TotalAttempts   sql.NullInt32   `json:"total_attempts"`
	BestAccuracy    sql.NullFloat64 `json:"best_accuracy"`
	AverageAccuracy sql.NullFloat64 `json:"average_accuracy"`
	AverageTime     sql.NullFloat64 `json:"average_time"`
	LastAttemptAt   sql.NullTime    `json:"last_attempt_at"`
	ID              int64           `json:"id"`
}

func (q *Queries) UpdatePerformanceSummary(ctx context.Context, arg UpdatePerformanceSummaryParams) (PerformanceSummary, error) {
	row := q.db.QueryRowContext(ctx, updatePerformanceSummary,
		arg.TotalAttempts,
		arg.BestAccuracy,
		arg.AverageAccuracy,
		arg.AverageTime,
		arg.LastAttemptAt,
		arg.ID,
	)
	var i PerformanceSummary
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.DictationID,
		&i.TotalAttempts,
		&i.BestAccuracy,
		&i.AverageAccuracy,
		&i.AverageTime,
		&i.LastAttemptAt,
	)
	return i, err
}

const userAggregatePerformance = `-- name: UserAggregatePerformance :many
SELECT 
    user_id,
    AVG(average_accuracy)::float AS overall_avg_accuracy,
    AVG(average_time)::float AS overall_avg_time
FROM performance_summary
GROUP BY user_id
`

type UserAggregatePerformanceRow struct {
	UserID             sql.NullInt64 `json:"user_id"`
	OverallAvgAccuracy float64       `json:"overall_avg_accuracy"`
	OverallAvgTime     float64       `json:"overall_avg_time"`
}

func (q *Queries) UserAggregatePerformance(ctx context.Context) ([]UserAggregatePerformanceRow, error) {
	rows, err := q.db.QueryContext(ctx, userAggregatePerformance)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []UserAggregatePerformanceRow
	for rows.Next() {
		var i UserAggregatePerformanceRow
		if err := rows.Scan(&i.UserID, &i.OverallAvgAccuracy, &i.OverallAvgTime); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
